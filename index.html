<!--
Copyright (c)  2012   John King
Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:
The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
-->
<html>
<head>
<meta name="google-site-verification" content="urlI98uR-E1CxkgmtiHXUTowCXbv8VdQUiA1PkeetNk" />

<title>Canvas Draw</title>
<style>
div {
	position: absolute;
}


img.marker {
	position:absolute;
	}
	
#background {
	top:0;
	left:0;
	width: 100%;
	height:100%;
	overflow:auto;
	background-color:#999999;
	visibility:hidden;

}

#drawarea {
	top:52px;
	left:0px;
	width: 100%;
	height:85%;
	visibility:hidden;
}

#canvasarea {
	top:52px;
	left:0px;
	width: 100%;
	height:85%;
	background-color:white;
	border:solid black 1px;
	visibility:hidden;
}

#canvasframe {
	top:52px;
	left:0px;
	width: 100%;
	height:80%;
	border:solid black 1px;
	visibility:hidden;
}

#bodydiv {
	top:52px;
	left:0px;
	width: 100%;
	height:85%;


	overflow:auto;
}

#filmbodydiv {
	top:52px;
	left:0px;
	width: 100%;
	height:85%;
	visibility:hidden;

}

#filmdivhandle {
	width:49px;
	height:46px;
	filter:alpha(opacity=50);
	opacity:0.5;
	visibility:hidden;
	background-image:url(assets/filmove.png);

}

#animationdiv {
	top:52px;
	left:0px;
	width: 100%;
	height:85%;

	visibility:hidden;
}

#canvasdiv {
	top:52px;
	left:0px;
	width: 100%;
	height:85%;
	background-color:transparent;
}

.dialoguebox {
	border: 1px solid #000000;
	visibility:hidden;
	z-index:4;
}

.head {
	background-color: #000000;

	color: #FFFFFF;
	font-size:12pt;
	font-weight: bold;
	height:25px;
	width: 100%;
}

.head img {
	float:right;
}

.content {
	background-color: #DDDDDD;
	width: 100%;
	top:25px;
}

.content input {
	position:relative;
	text-align:right;
	margin-left:2px;

}

p.text_input label {
	position:relative;
	left:5px;
}

p.text_input input {
	left:30px;
}

p.text_input span {
	position:relative;
	left:40px;
}

p.chk_radio_input input{
	left:5px;
}

p.chk_radio_input label {
	position:relative;
	left:10px;
}

#shapestage, #scenestage, #spritestage, #trackstage, #tweenstage, #filmstage {
	visibility:hidden;
}

#stageframe {
	visibility:hidden;
	border:1px solid black;
	z-index:0;
}

#stagearea {
	background-color: #FFFFFF;
	z-index:0;
}

.theatre_style {
	visibility:hidden;
	top:0px;
	left:0px;
	width: 100%;
	height:100%;
	z-index:1;
}

#hidecanvas {
	top:0px;
	left:0px;
	width: 10px;
	height:10px;
	background-color:transparent;
	visibility:hidden;
}

#heading {
	top: 0px;
	left:0px;
	width: 100%;
	height:50px;
	background-color:#66FFFF;
	z-index:2;
}


#logo {
	top: 4px;
	left: 200px;
}
	

#toolbar {
	top: 60px;
	left:10px;
	width: 95px;
	height:515px;
	z-index:1;
	border:solid 1px #000000;
	background-color:#66FFFF;
	visibility:hidden;
}

#tlbrhead {
	top: 0px;
	left:0px;
	width: 95px;
	height:25px;

	border-bottom:solid 1px #000000;
	background-color:#000099;
	color:#FFFFFF;
}

#filmsbar {
	top: 60px;
	left:10px;
	width: 115px;
	height:515px;

	border:solid 1px #000000;
	background-color:#66FFFF;
	visibility:hidden;
	text-align:center;
}

#filmsbrhead {
	top: 0px;
	left:0px;
	width: 115px;
	height:25px;
	border-bottom:solid 1px #000000;
	background-color:#000099;
	color:#FFFFFF;
}

#filmsholder {
	top: 26px;
	left:0px;
	width: 115px;
	height:450px;
	color:#000000;
	overflow:auto;
}

#filmsmove {
	top: 484px;
	left:0px;
	width: 115px;
	height:25px;
}

div.bar {
	background-color:#66FFFF;
	top: 0px;
	left:0px;
	height:29px;
	width:107px;
}

#anibar {
	top: 60px;
	left:5px;
	width: 115px;
	height:520px;

	border:solid 1px #000000;
	background-color:#66FFFF;
	visibility:hidden;
}

#anibarhd {
	top: 0px;
	left:0px;
	width: 115px;
	height:25px;

	border-bottom:solid 1px #000000;
	background-color:#000099;
	color:#FFFFFF;
}

#anigroup {
	top:260px;
	left:5px;
	width:107px;
	height:480px;
	clip:rect(0, 107, 250, 0);
}

#msggroup {
	top:2px;
	left:0px;
	width:97px;
	height:110px;
	font-size:12px;
	padding:4px 4px 4px 4px;
	border:solid 1px #000000;
	background-color:#66FFFF;
	visibility:hidden;

}

#msgblank {
	top:0px;
	left:0px;
	width:107px;
	height:250px;
	background-color:#66FFFF;
	visibility:hidden;

}

#buildgroup {
	top: 30px;
	left:5px;
	width: 107px;
	height:220px;
	background-color:#66FFFF;
}

#anibuild {
	top: 0px;
	left:0px;
	width: 105px;
	height:25px;
	background-color:#FFFFFF;
	background-color:#000099;
	color:#FFFFFF;
	border:solid 1px black;
}

#scenegroup{
	top: 0px;
	left:0px;
	width: 107px;
	height:130px;
}

#aniscene {
	top: 4px;
	left:0px;
	width: 105px;
	height:25px;
	background-color:#000099;
	color:#FFFFFF;
	border:solid 1px black;
}

#spritegroup{
	top: 130px;
	left:0px;
	width: 107px;
	height:130px;
}

#anisprite {
	top: 4px;
	left:0px;
	width: 105px;
	height:25px;
	background-color:#000099;
	color:#FFFFFF;
	border:solid 1px black;
}

#tweengroup{
	top: 335px;
	left:0px;
	width: 107px;
	height:345px;
}


#anitween {
	top: 4px;
	left:0px;
	width: 105px;
	height:25px;
	background-color:#000099;
	color:#FFFFFF;
	filter:alpha(opacity=60);
	opacity:0.6;
	border:solid 1px black;
}

#trackgroup{
	top: 395px;
	left:0px;
	width: 107px;
	height:130px;
}

#anitrack {
	top: 4px;
	left:0px;
	width: 105px;
	height:25px;
	background-color:#000099;
	color:#FFFFFF;
	filter:alpha(opacity=60);
	opacity:0.6;
	border:solid 1px black;
}

#filmgroup{
	top: 395px;
	left:0px;
	width: 107px;
	height:345px;
}

#anifilm {
	top: 4px;
	left:0px;
	width: 105px;
	height:25px;
	background-color:#000099;
	color:#FFFFFF;
	filter:alpha(opacity=60);
	opacity:0.6;
	border:solid 1px black;
}

#filmhold {
	top: 31px;
	left:0px;
	width: 105px;
	height:97px;
	background-color:#FFFFFF;
	border:solid 1px black;
	overflow:auto;
}
#trackhold {
	top:31px;
	left:0px;
	width: 105px;
	height:97px;
	background-color:#FFFFFF;
	border:solid 1px black;
	overflow:auto;
}

#spritehold {
	top: 31px;
	left:0px;
	width: 105px;
	height:97px;
	background-color:#FFFFFF;
	border:solid 1px black;
	overflow:auto;
}

#tweenhold {
	top: 31px;
	left:0px;
	width: 105px;
	height:97px;
	background-color:#FFFFFF;
	border:solid 1px black;
	overflow:auto;
}

#scenehold {
	top: 31px;
	left:0px;
	width: 105px;
	height:97px;
	background-color:#FFFFFF;
	border:solid 1px black;
	overflow:auto;
}

#buildhold {
	top: 26px;
	left:0px;
	width: 105px;
	height:190px;
	background-color:#FFFFFF;
	border:solid 1px black;
}

#gradcanvas {
	position:absolute;
	top:52px;
	left:0px;

}

#colorcont {
	height:411px;
	width:335px;//531px;
	clip:rect(1,550px,430px,0);
}

#colormask {
	height:380px;
	width:325px;//531px;
	background-color:#FFFFFF;
}

#colorpick {
	top:25px;
	left:0px;
	height:386px;
	width:335px;//531px;
	background-color:#FFFFFF;
}

#gradientbox {
	cursor:crosshair;
	top:15px;
	left:15px;
	width:256px;
	height:256px;
}

#gradientImg {
	display:block;
	width:256px;
	height:256px;
}

#transpbox {
	height:50px;
	width:256px;
	top:280px;
	left:15px;
}

#transpslider {
	height:17px;
	width:256px;
	top:9px;
	left:0px;
	border:1px solid black;
	filter:alpha(opacity=60);
	opacity:0.6;
}

#transpimg {
	height:17px;
	width:256px;
	top:9px;
	left:0px;
	border:1px solid black;

}

#transpcover {
	height:17px;
	width:256px;
	top:9px;
	left:0px;
	border:1px solid black;
}

#transptext {
	top:40px;
	left:0px;
}

#colform {
	top:350px;
	left:15px;
}
#varrows {
	width:9px;
	height:35px;
	left:0px;
	top:0px;	
}

#circle {
	height:11px;
	width:11px;
}

#hueBarDiv {
	left:280px;
	width:35px;
	height:256px;
	top:15px;
}

#colorbar {
	height:256px;
	width:19px;
	left:8px;
}
#arrows {
	height:9px;
	width:35px;
	left:0px;
}

#coldigits {
	left:155px;//370px;
	width:180px;
	height:256px;
	top:15px;
}

#colvertline {
	width:10px; 
	height:386px; 
	background-color: #888888; 
	left:170px;
	top:-15px;
}

#quickColor {
	height:50px;
	width:73px;
	top:0px;
	left:0px;	
}

#staticColor {
	height:50px;
	width:72px;
	top:0px;
	left:73px;
}

.choice40 {
	opacity:0.40;
    -ms-filter:"progid:DXImageTransform.Microsoft.Alpha(opacity=40)";
    filter:alpha(opacity=40);
	cursor:pointer;
}

.choice100 {
	opacity:1;
    -ms-filter:"progid:DXImageTransform.Microsoft.Alpha(opacity=100)";
    filter:alpha(opacity=100);
}

#export {
	left:110px;
	top:4px;
	visibility:hidden;
}

#visit {
	left:60px;
	top:4px;
	visibility:hidden;
}

#help {
	left:10px;
	top:4px;
	visibility:hidden;
}

#menushape, #copy, #editlines, #group, #ungroup, #rotate, #collines, #gradfill, #sname, #alntop, #alnbot{
	left:50px;
	visibility:hidden; 
}

#grid, #del, #front, #back, #vert, #horz, #stylelines, #colfill, #shadow, #lundo, #alnright, #alnleft {
	left:5px;
	visibility:hidden;
}

#menushape, #grid {
	top:30px; 
}
#copy, #del {
	top:80px; 
}
#editlines, #group, #ungroup, #front, #back {
	top:130px; 
}

#rotate, #horz {
	top:180px; 
}
#collines, #stylelines {
	top:230px; 
}
#gradfill, #colfill {
	top:280px; 
}
#sname, #shadow {
	top:330px; 
}

#back {
	left:25px; 
}

#vert {
	top:196px; 
}

#lundo {
	top:430px; 
}
#alnright {
	left:25px; 
}

#fopts {
	left:110px;
	top:50px;
	padding:2px 2px 2px 2px;
	border:solid #000000 1px;
	background-color:#FFFFFF;
	visibility:hidden;
}

#vecdiv {
	left:500px;
	top:300px;
	width:220px;
	height:220px;
	visibility:hidden;
}

#vecrotate {
	left:210px;
	top:105px;
	width:10px;
	height:10px;
	font-size:0;
}

#spritecentre {
	left:500px;
	top:300px;
	width:20px;
	height:20px;

	font-size:0;
	visibility:hidden;
}

</style>
<script type="text/javascript" src="http://yui.yahooapis.com/combo?2.9.0/build/yahoo-dom-event/yahoo-dom-event.js&2.9.0/build/dragdrop/dragdrop-min.js"></script> 

<script type="text/javascript" src = "scripts/mark.js" ></script>
<script type="text/javascript" src = "scripts/shape.js" ></script>
<script type="text/javascript" src = "scripts/draw.js" ></script>
<script type="text/javascript" src = "scripts/dialogue.js" ></script>

<script type="text/javascript" src = "scripts/drawboundary.js" ></script>
<script type="text/javascript" src = "scripts/corner.js" ></script>
<script type="text/javascript" src = "scripts/bottomhandle.js" ></script>
<script type="text/javascript" src = "scripts/righthandle.js" ></script>
<script type="text/javascript" src = "scripts/canvas.js" ></script>
<script type="text/javascript" src = "scripts/pointsmenu.js" ></script>
<script type="text/javascript" src = "scripts/linesmenu.js" ></script>
<script type="text/javascript" src = "scripts/colorpicker.js" ></script>
<script type="text/javascript" src = "scripts/export.js" ></script>
<script type="text/javascript" src = "scripts/exportfilmall.js" ></script>
<script type="text/javascript" src = "scripts/canvasshapes.js" ></script>
<script type="text/javascript" src = "scripts/drawshapes.js" ></script>
<script type="text/javascript" src = "scripts/shapemenu.js" ></script>
<script type="text/javascript" src = "scripts/linemarker.js" ></script>
<script type="text/javascript" src = "scripts/group.js" ></script>
<script type="text/javascript" src = "scripts/gradientmarker.js" ></script>
<script type="text/javascript" src = "scripts/gradmenu.js" ></script>
<script type="text/javascript" src = "scripts/rotate.js" ></script>
<script type="text/javascript" src = "scripts/grid.js" ></script>
<script type="text/javascript" src = "scripts/reflect.js" ></script>
<script type="text/javascript" src = "scripts/shadowmenu.js" ></script>
<script type="text/javascript" src = "scripts/canvashtml.js" ></script>
<script type="text/javascript" src = "scripts/idmenu.js" ></script>
<script type="text/javascript" src = "scripts/totext.js" ></script>
<script type="text/javascript" src = "scripts/fromtext.js" ></script>
<script type="text/javascript" src = "scripts/alongpath.js" ></script>
<script type="text/javascript" src = "scripts/buildmenu.js" ></script>
<script type="text/javascript" src = "scripts/animations.js" ></script>
<script type="text/javascript" src = "scripts/filmpropmenu.js" ></script>
<!--[IF IE]><script type="text/javascript" src = "scripts/excanvas.compiled.js" ></script><![endif]-->
<script type="text/javascript">

ieb=navigator.appName=='Microsoft Internet Explorer';
iop=navigator.appName=='Opera';
var blocknum=0;
var numblocks=0;
squote="'";
dquote='"';
var parentselected=null;

var lnmrks=0;
var gdmrks=0;
var rdmrks=0;
var rtmrks=0;
var bndries=0;
var hidnum=0;
var gpnum=0;
var inln=false;
var selected=[];
var gp=[];
var firstclick=false;
var endpoint=false;
var curcanv='empty';
var currentColor = Colors.ColorFromRGB(64,128,128);
var alphaperct=0;
var coltype='F';
var xgrid=1;
var ygrid=1;
var grdon=false;
var showgrd=false;
var shapestarted=false;
var coldir='up';
var masterwidth;
var masterheight;
var storedw=0;
var storedh;
var magscale=100;
var actualwidth;
var actualheight;
var activewidth;
var activeheight;
var shapejustcreated=false;
var editjustcreated=false;
var undo=[];
var worksaved=false;
var flname='';
var fstar='';
var logurl='';
var filecount=0;
var file=[];
var filenum=0;
var canvases=0
var subcount=0;
var subfile=[];
var subfilenum=0;
var stf=[];
var piccount=0;
var picfile=[];
var picfilenum=0;
var pctf=[];
var aniselect=[];
var minivect;
var vector={xs:0, xe:0,ys:0, ye:0};
var vecanv;
var vecphi;
var midx={x:0,y:0};
var spritecentre;
var aniobj='scene';
var doingani=false;
var tracktarg;
var anitarg;
var ani;
var scenecount=0;
var trackcount=0;
var spritecount=0;
var tweencount=0;
var filmcount=0;
var stopchecking=false;
var canvases;
var elmsadded;
var editcheck=false;
var trackcheck=false;
var flmovetop;
var flmoveleft;
var CURSOR;  //previous cursor point
var SHAPES={};  // list of shapes
var SELECTED={}; //list of selected shapes
var SELECTEDSHAPE; //shape clicked on
var GROUPS={}; //list of groups
var SCRW; //actual screen width
var SCRH; //actual screen height
var MCOUNT=0; //counter for id of marks
var BCOUNT=0; //counter for id of boundaries
var SCOUNT=0; //counter for shapes
var GCOUNT=0; //counter for groups
var ZPOS=1; //zindex for each shape as created or set to front
var ZNEG=-1; //zindex for shapes when zindex sent to back
var ZSTART,ZOFFSET; //ensure z-order maintained when copying shapes;
var K=4*(Math.SQRT2-1)/3; //constant for circles using Bezier curve.
var DEFAULTKEYDOWN=document.onkeydown;
var BACKDROP; // object where backstage canvas is added for bezguides;
temptrack={};
tracks = {};
scenes = {};
sprites = {};
tweens = {};
films = {};

String.prototype.elType=elType;

if(typeof String.prototype.trim !== 'function') {
  String.prototype.trim = function() {
    return this.replace(/^\s+|\s+$/g, ''); 
  }
}

if(!Array.indexOf){
	    Array.prototype.indexOf = function(obj){
	        for(var i=0; i<this.length; i++){
	            if(this[i]==obj){
	                return i;
	            }
	        }
	        return -1;
	    }
	}


function $(id)
{
      return document.getElementById(id);
}

for( var i=0; i<3; i++)
{
	stf[i]=false;
}

for( var i=0; i<3; i++)
{
	pctf[i]=false;
}

function str_rep(n) 
{
   var s = "", t = this.toString();
   while (--n >= 0) 
   {
     s += t
   }
   return s;
}

String.prototype.repeat = str_rep;

function eventcap(e)
{
	if (!e) var e = window.event;
	return e;
}

function noBubble(e)
{
	if (!e) var e = window.event;
	e.cancelBubble = true;
	if (e.stopPropagation) e.stopPropagation();
}

function cancelEvent(e) 
{
	if (!e) e = window.event;
	if (e.preventDefault) 
	{
		e.preventDefault();
	} 
	else 
	{
		e.returnValue = false;
	}
}

function shiftdown(e)
{
	
	e = e || window.event;
	return e.shiftKey;
}

function getPosition(e) {
    e = e || window.event;
    var cursor = {x:0, y:0};
    if (e.pageX || e.pageY) {
        cursor.x = e.pageX;
        cursor.y = e.pageY;
    } 
    else {
        var de = document.documentElement;
        var b = document.body;
        cursor.x = e.clientX + 
            (de.scrollLeft || b.scrollLeft) - (de.clientLeft || 0);
        cursor.y = e.clientY + 
            (de.scrollTop || b.scrollTop) - (de.clientTop || 0);
    }
    return cursor;
}



function aligntop()
{
	var sl=selected.length;
	var mnt=100000000;
	var dmnt;
	for (var i=0; i<sl; i++)
	{
		if (selected[i].btop<mnt) {mnt=selected[i].btop}
	}
	for (var i=0; i<sl; i++)
	{
		dmnt=mnt-selected[i].btop;
		selected[i].btop=mnt;
		for (var j=3; j<selected[i].path.length; j++)
		{
			for(var k=2; k<selected[i].path[j].length;k+=2)
			{
				selected[i].path[j][k]+=dmnt;
			}
		}
		selected[i].boundary.style.top=mnt;
		selected[i].boundary.otop=mnt;
		selected[i].sctop=selected[i].btop;
		selected[i].lineGrad[1] +=dmnt;
		selected[i].lineGrad[3] +=dmnt;
		selected[i].radGrad[1] +=dmnt;
		selected[i].radGrad[4] +=dmnt;
		selected[i].cy +=dmnt;
		drawline(selected[i]);
	}
}

function alignleft()
{
	var sl=selected.length;
	var mnl=100000000;
	var dmnl;
	for (var i=0; i<sl; i++)
	{
		if (selected[i].bleft<mnl) {mnl=selected[i].bleft}
	}
	for (var i=0; i<sl; i++)
	{
		dmnl=mnl-selected[i].bleft;
		selected[i].bleft=mnl;
		for (var j=3; j<selected[i].path.length; j++)
		{
			for(var k=1; k<selected[i].path[j].length;k+=2)
			{
				selected[i].path[j][k]+=dmnl;
			}
		}
		selected[i].boundary.style.left=mnl;
		selected[i].boundary.oleft=mnl;
		selected[i].scleft=selected[i].bleft;
		selected[i].lineGrad[0] +=dmnl;
		selected[i].lineGrad[2] +=dmnl;
		selected[i].radGrad[0] +=dmnl;
		selected[i].radGrad[3] +=dmnl;
		selected[i].cx +=dmnl;
		drawline(selected[i]);
	}
}

function alignright()
{
	var sl=selected.length;
	var mxl=-100000000;
	var dmxl;
	for (var i=0; i<sl; i++)
	{
		if (selected[i].bleft+selected[i].bwidth>mxl) {mxl=selected[i].bleft+selected[i].bwidth}
	}
	for (var i=0; i<sl; i++)
	{
		dmxl=mxl-(selected[i].bleft+selected[i].bwidth);
		for (var j=3; j<selected[i].path.length; j++)
		{
			for(var k=1; k<selected[i].path[j].length;k+=2)
			{
				selected[i].path[j][k]+=dmxl;
			}
		}
		selected[i].boundary.style.left=mxl-parseInt(selected[i].boundary.style.width);
		selected[i].bleft=parseInt(selected[i].boundary.style.left);
		selected[i].boundary.oleft=parseInt(selected[i].boundary.style.left);
		selected[i].scleft=selected[i].bleft;
		selected[i].lineGrad[0] +=dmxl;
		selected[i].lineGrad[2] +=dmxl;
		selected[i].radGrad[0] +=dmxl;
		selected[i].radGrad[3] +=dmxl;
		selected[i].cx +=dmxl;
		drawline(selected[i]);
	}
}

function alignbot()
{
	var sl=selected.length;
	var mxt=-100000000;
	var dmxt;
	for (var i=0; i<sl; i++)
	{
		if (selected[i].btop+selected[i].bheight>mxt) {mxt=selected[i].btop+selected[i].bheight}
	}
	for (var i=0; i<sl; i++)
	{
		dmxt=mxt-(selected[i].btop+selected[i].bheight);
		for (var j=3; j<selected[i].path.length; j++)
		{
			for(var k=2; k<selected[i].path[j].length;k+=2)
			{
				selected[i].path[j][k]+=dmxt;
			}
		}
		selected[i].boundary.style.top=mxt-parseInt(selected[i].boundary.style.height);
		selected[i].btop=parseInt(selected[i].boundary.style.top);
		selected[i].boundary.otop=parseInt(selected[i].boundary.style.top);
		selected[i].sctop=selected[i].btop;
		selected[i].lineGrad[1] +=dmxt;
		selected[i].lineGrad[3] +=dmxt;
		selected[i].radGrad[1] +=dmxt;
		selected[i].radGrad[4] +=dmxt;
		selected[i].cy +=dmxt;
		drawline(selected[i]);
	}
}

function openhelp()
{
	window.open('https://sites.google.com/site/canvimationhelp/');
}

function visitgallery()
{
	window.open('gallery/vector continuous.html');
}


function shapedelete()
{
	$('shapemenu').style.visibility='hidden';
	$('group').style.visibility='hidden';
	$('ungroup').style.visibility='hidden';
	$('stylelines').style.visibility='hidden';
	$('collines').style.visibility='hidden';	
	$('colfill').style.visibility='hidden';
	$('gradfill').style.visibility='hidden';
	$('rotate').style.visibility='hidden';
	$('front').style.visibility='hidden';
	$('back').style.visibility='hidden';
	$('del').style.visibility='hidden';
	$('copy').style.visibility='hidden';
	$('editlines').style.visibility='hidden';
	$('vert').style.visibility='hidden';
	$('horz').style.visibility='hidden';
	$('alntop').style.visibility='hidden';
	$('alnbot').style.visibility='hidden';
	$('alnleft').style.visibility='hidden';
	$('alnright').style.visibility='hidden';
	$('shadow').style.visibility='hidden';
	$('sname').style.visibility='hidden';
	closeColor();
	removeGradLine();
	removeRotate();	
	var bd=$('bodydiv');
	var bdc=$('bodydiv').childNodes;
	while(bdc.length>0)
	{
		bd.firstChild.canvas.boundary='empty';
		bd.firstChild.parentNode.removeChild(bd.firstChild);
		bdc=$('bodydiv').childNodes;
	}
	var canv;
	undo.push('bottom');
	while (selected.length>0)
	{
		canv=selected.pop();
		undo.push(canv);
		canv.parentNode.removeChild(canv);
		
	}
	$('lundo').style.visibility='visible';
}





function bringfront()
{
	var slist=[];
	var sl=selected.length;
	var temps
	for (var i=0; i<sl; i++)
	{
		temps=[];
		temps[0]=selected[i].id;
		temps[1]=selected[i].style.zIndex;
		slist.push(temps);
	}
	slist.sort(zindp);
	
	for (var i=0; i<slist.length;i++)
	{
		$(slist[i][0]).zIndex=zpos++;
		$(slist[i][0]).style.zIndex=$(slist[i][0]).zIndex;
	}
	
	function zindp(a,b)
	{
		return a[1]-b[1]
	}
}

function sendback()
{
	var slist=[];
	var sl=selected.length;
	var temps
	for (var i=0; i<sl; i++)
	{
		temps=[];
		temps[0]=selected[i].id;
		temps[1]=selected[i].style.zIndex;
		slist.push(temps);
	}
	slist.sort(zindn);
	
	for (var i=0; i<slist.length;i++)
	{
		$(slist[i][0]).zIndex=zneg--;
		$(slist[i][0]).style.zIndex=$(slist[i][0]).zIndex;
	}
	
	function zindn(a,b)
	{
		return b[1]-a[1]
	}
}



function undolast()
{
	var canv=undo.pop();
	while (canv!='bottom')
	{
		$('canvasdiv').appendChild(canv);
		drawline(canv);
		canv=undo.pop();
	}
	if (undo.length==0) {$('lundo').style.visibility='hidden'};
}

function clear(stage)
{
	while(stage.childNodes.length>0)
	{
		stage.removeChild(stage.firstChild)
	}
}

function showmenu()
{
	if (!shapestarted)
	{
		if (parseInt($('toolbar').style.left)>0.85*maxwidth)
		{
			$('shapemenu').style.left=-65;
		}
		$('shapemenu').style.visibility='visible';
		$('markerdrop').style.visibility='hidden';
		clear($("markerdrop"));
		MCOUNT=0;
		$('group').style.visibility='hidden';
		$('ungroup').style.visibility='hidden';
		$('stylelines').style.visibility='hidden';
		$('collines').style.visibility='hidden';	
		$('colfill').style.visibility='hidden';
		$('gradfill').style.visibility='hidden';
		$('rotate').style.visibility='hidden';
		$('front').style.visibility='hidden';
		$('back').style.visibility='hidden';
		$('del').style.visibility='hidden';
		$('copy').style.visibility='hidden';
		$('editlines').style.visibility='hidden';
		$('vert').style.visibility='hidden';
		$('horz').style.visibility='hidden';
		$('alntop').style.visibility='hidden';
		$('alnbot').style.visibility='hidden';
		$('alnleft').style.visibility='hidden';
		$('alnright').style.visibility='hidden';
		$('shadow').style.visibility='hidden';
		$('sname').style.visibility='hidden';
		$('fopts').style.visibility='hidden';
		closeColor();
		removeGradLine();
		removeRotate();
		var bd=$('bodydiv');
		var bdc=$('bodydiv').childNodes;
		while(bdc.length>0)
		{
			if (bd.firstChild.id.substr(0,8)=='boundary')
			{
				bd.firstChild.canvas.boundary='empty';
			}
			bd.firstChild.parentNode.removeChild(bd.firstChild);
			bdc=$('bodydiv').childNodes;
		}
		selected=[];
		if (curcanv !='empty') {drawline(curcanv)};
	}
}

function animenuset(id)
{
	$('aniscene').style.opacity=0.6;
	$('anisprite').style.opacity=0.6;
	$('anitween').style.opacity=0.6;
	$('anitrack').style.opacity=0.6;
	$('anifilm').style.opacity=0.6;
	if (ieb)
	{
		$('aniscene').filters.alpha.opacity=60;
		$('anisprite').filters.alpha.opacity=60;
		$('anitween').filters.alpha.opacity=60;
		$('anitrack').filters.alpha.opacity=60;
		$('anifilm').filters.alpha.opacity=60;
	}
	$('aniscene').onmouseover = function() {this.style.opacity=1;this.filters.alpha.opacity=100};
	$('aniscene').onmouseout = function() {this.style.opacity=0.6;this.filters.alpha.opacity=60};	
	$('anisprite').onmouseover = function() {this.style.opacity=1;this.filters.alpha.opacity=100};
	$('anisprite').onmouseout = function() {this.style.opacity=0.6;this.filters.alpha.opacity=60};
	$('anitween').onmouseover = function() {this.style.opacity=1;this.filters.alpha.opacity=100};
	$('anitween').onmouseout = function() {this.style.opacity=0.6;this.filters.alpha.opacity=60};
	$('anitrack').onmouseover = function() {this.style.opacity=1;this.filters.alpha.opacity=100};
	$('anitrack').onmouseout = function() {this.style.opacity=0.6;this.filters.alpha.opacity=60};
	$('anifilm').onmouseover = function() {this.style.opacity=1;this.filters.alpha.opacity=100};
	$('anifilm').onmouseout = function() {this.style.opacity=0.6;this.filters.alpha.opacity=60};
	$('ani'+id).style.opacity=1;
	if (ieb) {$('ani'+id).filters.alpha.opacity=100};
	$('ani'+id).onmouseover=function() {};
	$('ani'+id).onmouseout=function() {};
	switch(id)
	{
		case "scene":
			movenotscene();
		break;
		case "sprite":
			movenotsprite();
		break;
		case "tween":
			movenottween()
		break;
		case "track":
			movenottrack()
		break
		case "film":
			movenotfilm()
		break
	} 

}

function movenotscene()
{
		var finishedfilm=false;
		var finishedtrack=false;
		var finishedtween=false;
		var finishedsprite=false;
		if (parseInt($('trackgroup').style.top)<220)
		{
			$('trackgroup').style.top=parseInt($('trackgroup').style.top)+10
		}
		else
		{
			$('trackgroup').style.top=220;
			finishedtrack=true;
		}
		if (parseInt($('filmgroup').style.top)<190)
		{
			$('filmgroup').style.top=parseInt($('filmgroup').style.top)+10
		}
		else
		{
			$('filmgroup').style.top=190;
			finishedfilm=true;
		}

		if (parseInt($('tweengroup').style.top)<160)
		{
			$('tweengroup').style.top=parseInt($('tweengroup').style.top)+10
		}
		else
		{
			$('tweengroup').style.top=160;
			finishedtween=true;
		}
		if (parseInt($('spritegroup').style.top)<130)
		{
			$('spritegroup').style.top=parseInt($('spritegroup').style.top)+10
		}
		else
		{
			$('spritegroup').style.top=130;
			finishedsprite=true;
		}		
		if (!(finishedfilm && finishedtween && finishedtrack && finishedsprite)) {setTimeout(function() {movenotscene()},10)}			
}

function movenotsprite()
{
		var finishedfilm=false;
		var finishedtrack=false;
		var finishedtween=false;
		var finishedsprite=false;
		if (parseInt($('trackgroup').style.top)<220)
		{
			$('trackgroup').style.top=parseInt($('trackgroup').style.top)+10
		}
		else
		{
			$('trackgroup').style.top=220;
			finishedtrack=true;
		}
		if (parseInt($('filmgroup').style.top)<190)
		{
			$('filmgroup').style.top=parseInt($('filmgroup').style.top)+10
		}
		else
		{
			$('filmgroup').style.top=190;
			finishedfilm=true;
		}
		
		if (parseInt($('tweengroup').style.top)<160)
		{
			$('tweengroup').style.top=parseInt($('tweengroup').style.top)+10
		}
		else
		{
			$('tweengroup').style.top=160;
			finishedtween=true;
		}
		if (parseInt($('spritegroup').style.top)>30)
		{
			$('spritegroup').style.top=parseInt($('spritegroup').style.top)-10
		}
		else
		{
			$('spritegroup').style.top=30;
			finishedsprite=true;
		}		
		if (!(finishedfilm && finishedtween && finishedtrack && finishedsprite)) {setTimeout(function() {movenotsprite()},10)}			
}

function movenottween()
{
		var finishedfilm=false;
		var finishedtrack=false;
		var finishedtween=false;
		var finishedsprite=false;
		if (parseInt($('trackgroup').style.top)<220)
		{
			$('trackgroup').style.top=parseInt($('trackgroup').style.top)+10
		}
		else
		{
			$('trackgroup').style.top=220;
			finishedtrack=true;
		}
		if (parseInt($('filmgroup').style.top)<190)
		{
			$('filmgroup').style.top=parseInt($('filmgroup').style.top)+10
		}
		else
		{
			$('filmgroup').style.top=190;
			finishedfilm=true;
		}
		
		if (parseInt($('tweengroup').style.top)>60)
		{
			$('tweengroup').style.top=parseInt($('tweengroup').style.top)-10
		}
		else
		{
			$('tweengroup').style.top=60;
			finishedtween=true;
		}
		if (parseInt($('spritegroup').style.top)>30)
		{
			$('spritegroup').style.top=parseInt($('spritegroup').style.top)-10
		}
		else
		{
			$('spritegroup').style.top=30;
			finishedsprite=true;
		}		
		if (!(finishedfilm && finishedtween && finishedtrack && finishedsprite)) {setTimeout(function() {movenottween()},10)}			
}

function movenottrack()
{
		var finishedfilm=false;
		var finishedtrack=false;
		var finishedtween=false;
		var finishedsprite=false;
		if (parseInt($('trackgroup').style.top)>120)
		{
			$('trackgroup').style.top=parseInt($('trackgroup').style.top)-10
		}
		else
		{
			$('trackgroup').style.top=120;
			finishedtrack=true;
		}
		if (parseInt($('filmgroup').style.top)<90)
		{
			$('filmgroup').style.top=parseInt($('filmgroup').style.top)+10
		}
		else
		{
			$('filmgroup').style.top=90;
			finishedfilm=true;
		}
		
		if (parseInt($('tweengroup').style.top)>60)
		{
			$('tweengroup').style.top=parseInt($('tweengroup').style.top)-10
		}
		else
		{
			$('tweengroup').style.top=60;
			finishedtween=true;
		}
		if (parseInt($('spritegroup').style.top)>30)
		{
			$('spritegroup').style.top=parseInt($('spritegroup').style.top)-10
		}
		else
		{
			$('spritegroup').style.top=30;
			finishedsprite=true;
		}
		if (!(finishedfilm && finishedtween && finishedtrack  && finishedsprite)) {setTimeout(function() {movenottrack()},10)}			
}

function movenotfilm()
{
		var finishedfilm=false;
		var finishedtrack=false;
		var finishedtween=false;
		var finishedsprite=false;
		if (parseInt($('trackgroup').style.top)>220)
		{
			$('trackgroup').style.top=parseInt($('trackgroup').style.top)-10
		}
		else
		{
			$('trackgroup').style.top=220;
			finishedtrack=true;
		}
		if (parseInt($('filmgroup').style.top)>90)
		{
			$('filmgroup').style.top=parseInt($('filmgroup').style.top)-10
		}
		else
		{
			$('filmgroup').style.top=90;
			finishedfilm=true;
		}
		
		if (parseInt($('tweengroup').style.top)>60)
		{
			$('tweengroup').style.top=parseInt($('tweengroup').style.top)-10
		}
		else
		{
			$('tweengroup').style.top=60;
			finishedtween=true;
		}
		if (parseInt($('spritegroup').style.top)>30)
		{
			$('spritegroup').style.top=parseInt($('spritegroup').style.top)-10
		}
		else
		{
			$('spritegroup').style.top=30;
			finishedsprite=true;
		}
		if (!(finishedfilm && finishedtween && finishedtrack && finishedsprite)) {setTimeout(function() {movenotfilm()},10)}
}

function setStage()
{
	var stages=["area","frame"];
	for(var i=0; i<stages.length; i++)
	{
		$('stage'+stages[i]).style.top=(SCRH-$('stageheight').value)/2 - 52;
		$('stage'+stages[i]).style.left=(SCRW-$('stagewidth').value)/2;
		$('stage'+stages[i]).style.width=$('stagewidth').value;
		$('stage'+stages[i]).style.height=$('stageheight').value;
		$('stage'+stages[i]).style.visibility="visible";
	}
	$('stagebox').style.visibility="hidden";
	$('shapestage').style.visibility="visible";
	main();
}

function init()
{	
	SCRW=screen.availWidth;
	SCRH=screen.availHeight;
	$('startdiv').parentNode.removeChild($('startdiv'));
	$('stagebox').style.width=200;
	$('stagebox').style.height=150;
	$('stagecontent').style.height=parseInt($('stagebox').style.height)-25;
	$('stagebox').style.top=(SCRH-parseInt($('stagebox').style.height))/2 - 52;
	$('stagebox').style.left=(SCRW-parseInt($('stagebox').style.width))/2;
	$('stageOK').style.left=parseInt($('stagebox').style.width)-70;
	$('stagebox').style.visibility="visible";
	
}
	
function main()
{	
	BODY=document.getElementsByTagName("body")[0];
	$('toolbar').style.visibility='visible';
	$('anibar').style.visibility='visible';
	$('grid').style.visibility='visible';
	$('menushape').style.visibility='visible';
	$('background').style.visibility='visible';
	BACKDROP={};
	BACKDROP.zIndex=0;
	BACKDROP.addTo=addTo;
	BACKDROP.addTo($("backstage"));
	$("markerdrop").style.visibility="visible";
	$("markerdrop").onclick=function(e) {
	   										noBubble(e);
	   										checkBoundary(shiftdown(e),getPosition(e));
	   										//BACKDROP.Canvas.ctx.clearRect(0,0,SCRW,SCRH);
	   										//$("backstage").style.visibility="hidden";
	   									}
	 $("boundarydrop").onclick=function(e) {
	   										noBubble(e);
	   										checkBoundary(shiftdown(e),getPosition(e));
	   									}  									
	
	canvwidth=0.98*screen.availWidth;
	canvheight=0.785*screen.availHeight;
	maxwidth=canvwidth;
	maxheight=canvheight;
	masterwidth=0.80*maxwidth;
	masterheight=0.80*maxheight;
	gradcanv=$('gradcanvas');
	gridcanv=$('gridcanvas');
	$('filmdivhandle').style.top=masterheight/2-25;
	$('filmdivhandle').style.left=masterwidth/2-25;
	fhtfix=masterheight/2-25;
	fhlfix=masterwidth/2-25;

	
	if (!ieb)
	{
		document.getElementsByTagName('body')[0].addEventListener('dragover', handleDragOver, false);
		document.getElementsByTagName('body')[0].addEventListener('drop', handleBodyDrop, false);
	}
	
	DDcbxadj=new YAHOO.util.DD('canvasadjust');
	DDcbxadj.onDrag=function () {
									var cbxadj=$('canvasadjust');
									if ($('shportrait').checked)
									{
										cbxadj.style.top=cbxadj.top;
										var p=parseFloat($('WsizeofP').innerHTML);
										if (parseInt(cbxadj.style.left)>cbxadj.left)
										{
											if (p<1)
											{
												$('canvasbox').style.width = parseInt($('canvasbox').style.width) + 1;
												cbxadj.style.left =cbxadj.left+1;
												p=parseFloat($('canvasbox').style.width)/100;
												$('requdsizewidth').value= Math.round(masterheight*p);
											}
											else
											{
												cbxadj.style.left=cbxadj.left;
											}	
										}
										else
										{
											if (p>0.01)
											{
												$('canvasbox').style.width =parseInt($('canvasbox').style.width) - 1;
												cbxadj.style.left =cbxadj.left-1;
												p=parseFloat($('canvasbox').style.width)/100;
												$('requdsizewidth').value =Math.round(masterheight*p);
											}
											else
											{
												cbxadj.style.left=cbxadj.left;
											}
										}
										
										cbxadj.left=parseInt(cbxadj.style.left);
										$('WsizeofP').innerHTML=p+' ';
						
									}
									else
									{
										cbxadj.style.left=cbxadj.left;
										var p=parseFloat($('HsizeofP').innerHTML);
										if (parseInt(cbxadj.style.top)>cbxadj.top)
										{
											if (p<1)
											{
												$('canvasbox').style.height = parseInt($('canvasbox').style.height) + 1;
												cbxadj.style.top =cbxadj.top+1;
												p=parseFloat($('canvasbox').style.height)/100;
												$('requdsizeheight').value =Math.round(masterwidth*p);
											}
											else
											{
												cbxadj.style.top=cbxadj.top;
											}	
										}
										else
										{
											if (p>0.01)
											{
												$('canvasbox').style.height =parseInt($('canvasbox').style.height) - 1;
												cbxadj.style.top =cbxadj.top-1;
												p=parseFloat($('canvasbox').style.height)/100;
												$('requdsizeheight').value =Math.round(masterwidth*p);
											}
											else
											{
												cbxadj.style.top=cbxadj.top;
											}
										}
										cbxadj.top=parseInt(cbxadj.style.top);
										$('HsizeofP').innerHTML=p+' ';
									}
								}
	
	$('toolbar').style.left=10;
	$('toolbar').style.top=60;
	$('filmsbar').style.left=10;
	$('filmsbar').style.top=60;
	$('anibar').style.left=screen.availWidth-125;
	$('anibar').style.top=60;
	$('canvasdiv').style.height=maxheight-52;
	$('canvasdiv').style.width=maxwidth;
	//$('canvasdiv').style.zIndex=2;

	$('animationdiv').style.height=maxheight-52;
	$('animationdiv').style.width=maxwidth;

	$('colorcont').style.left= (canvwidth-525);
	$('colorcont').style.top= (canvheight-380)/2;
	$('colorcont').style.height=411;
	$('colorcont').style.width=335;
	
	$('colorpick').style.top=25;
	$('colorpick').style.height=386;
	
	$("coldigits").style.left=155;	
	
	$('export').style.visibility='visible';
	$('visit').style.visibility='visible';
	$('help').style.visibility='visible';
	
	$('filmgroup').style.top=190;	
	$('trackgroup').style.top=220;	
	$('tweengroup').style.top=160;
	$('spritegroup').style.top=130;	
	$('scenegroup').style.top=0;
	
	$('anibuild').onmouseover = function() {this.style.opacity=1;this.filters.alpha.opacity=100};
	$('anibuild').onmouseout = function() {this.style.opacity=0.6;this.filters.alpha.opacity=60};		
	
	DDtlbr=new YAHOO.util.DD('toolbar');
	DDtlbr.setHandleElId('tlbrhead');	
	
	DDtlbr=new YAHOO.util.DD('filmsbar');
	DDtlbr.setHandleElId('filmsbrhead');

	DDanibr=new YAHOO.util.DD('anibar');
	DDanibr.setHandleElId('anibarhd');
	
	DDcircle=new YAHOO.util.DD('circle');
	DDcircle.onDrag = function () {
									if (parseInt($('circle').style.left)<-5) {$('circle').style.left=-5}
									if (parseInt($('circle').style.left)>250) {$('circle').style.left=250}
									if (parseInt($('circle').style.top)<-5) {$('circle').style.top=-5}
									if (parseInt($('circle').style.top)>250) {$('circle').style.top=251}
									currentColor.SetHSV(currentColor.Hue(), 1-(parseInt($('circle').style.top)+5)/255.0, 
									  (parseInt($('circle').style.left)+5)/255.0);
  									colorChanged("circle");
								  }
	DDarrows=new YAHOO.util.DD('arrows');
	DDarrows.onDrag = function () {
										$('arrows').style.left=0;
										if (parseInt($('arrows').style.top)<-4) {$('arrows').style.top=-4}
										if (parseInt($('arrows').style.top)>251) {$('arrows').style.top=251}
  										currentColor.SetHSV((256 - parseInt($('arrows').style.top)+4)*359.99/255, 
										  currentColor.Saturation(), currentColor.Value());
  										colorChanged("arrows");
								};

									
	$('varrows').style.left=-4;
	DDvarrows=new YAHOO.util.DD('varrows');
	DDvarrows.setHandleElId("transpbox");
	DDvarrows.onDrag = function () {
										$('varrows').style.top=0;
										if (parseInt($('varrows').style.left)<-4) {$('varrows').style.left=-4}
										if (parseInt($('varrows').style.left)>252) {$('varrows').style.left=252}
										alphaperct=Math.ceil(100*(parseInt($('varrows').style.left)+4)/256);
										$('transptext').innerHTML ='Transparency '+alphaperct+'%';
										if (ieb)
										{
											$('transpslider').filters.alpha.opacity=100-alphaperct;
										}
										else
										{
											$('transpslider').style.opacity=1-alphaperct/100;
										}
											
  
								};
																			
	DDcc=new YAHOO.util.DD('colorcont');
	DDcc.setHandleElId('colorhead');

	fixGradientImg();
	
	colorChanged('box');
													  
	var su = new shapeMenu();
		
	$("redBox").value=255;
	redBoxChanged();
	$("greenBox").value=255;
	greenBoxChanged();
	$("blueBox").value=255;
	blueBoxChanged();
	alphaperct = 0;
	$('varrows').style.left=256*alphaperct/100-4;
	$('transptext').innerHTML ='Transparency '+Math.floor(alphaperct)+'%';
	if (ieb)
	{
		$('transpslider').filters.alpha.opacity=100-alphaperct;
	}
	else
	{
		$('transpslider').style.opacity=1-alphaperct/100;
	}
	$("transpslider").style.backgroundColor = currentColor.HexString();
	$('colorheadtext').innerHTML='\u00A0 Background Colour';

	$('gradientBox').onclick=function(e) {
											moveCircleTo(getPosition(e))
										};
	
	$('transpbox').onclick=function(e) {
											movetransarrwTo(getPosition(e))
										};
	$('hueBarDiv').onclick=function(e) {
											HueBarmoveTo(getPosition(e))
										};															

	
    if (gradcanv.getContext)
	{
        gradcanv.ctx = gradcanv.getContext('2d');
    }
	
	
    if (gridcanv.getContext)
	{
        gridcanv.ctx = gridcanv.getContext('2d');
    }
	gridcanv.style.position='absolute';
	gridcanv.style.left=0;
	gridcanv.style.top=52;
	//gridcanv.style.zIndex=2;
	
	$('vecdiv').style.left=500;
	$('vecdiv').style.top=200;
	
	vecanv=$('vecanv')
    if (vecanv.getContext)
	{
        vecanv.ctx = vecanv.getContext('2d');
    }
	vecanv.width=220;
   	vecanv.height=220;
	vecanv.ctx.translate(110,110);
	vecanv.ctx.save();
	vecanv.ctx.beginPath();
	vecanv.ctx.moveTo(0,0);	
	vecanv.ctx.lineTo(100,0);
	vecanv.ctx.moveTo(90,-10);
	vecanv.ctx.lineTo(100,0);
	vecanv.ctx.lineTo(90,10);
	vecanv.ctx.stroke();
	minivect={xs:0, xe:100,ys:0, ye:0};
	
	DDvecdiv=new YAHOO.util.DD('vecdiv');
	
	vecirc=$('vecircdiv')
    if (vecirc.getContext)
	{
        vecirc.ctx = vecirc.getContext('2d');
    }
	vecirc.width=10;
   	vecirc.height=10;
	vecirc.ctx.translate(5,5);
	
	vecirc.ctx.beginPath();
	vecirc.ctx.arc(0,0,5,0,2*Math.PI, false);
	vecirc.ctx.stroke();
	vecphi=0;
	
	DDvecrotate=new YAHOO.util.DD('vecrotate');
	DDvecrotate.onDrag = function()
						 {
						 		var phi=arctan(parseInt($('vecrotate').style.left)-105,parseInt($('vecrotate').style.top)-105);
								$('vecrotate').style.left=105+105*Math.cos(phi);
								$('vecrotate').style.top=105+105*Math.sin(phi);
								minivect.xe=100*Math.cos(phi);
								minivect.ye=100*Math.sin(phi);
								vecanv.ctx.rotate(-vecphi);
								vecanv.ctx.clearRect(-220,-220,440,440);
								
								vecphi =phi;
								
								vecanv.ctx.beginPath();
								vecanv.ctx.rotate(phi);
								vecanv.ctx.moveTo(0,0);	
								vecanv.ctx.lineTo(100,0);
								vecanv.ctx.moveTo(90,-10);
								vecanv.ctx.lineTo(100,0);
								vecanv.ctx.lineTo(90,10);
								vecanv.ctx.stroke();
						 }

	spritemid=$('spritemidiv')
    if (spritemid.getContext)
	{
        spritemid.ctx = spritemid.getContext('2d');
    }
	spritemid.width=20;
   	spritemid.height=20;
	spritemid.ctx.translate(10,10);
	
	spritemid.ctx.beginPath();
	spritemid.ctx.arc(0,0,10,0,2*Math.PI, false);
	spritemid.ctx.moveTo(0,10);
	spritemid.ctx.lineTo(0,-10);
	spritemid.ctx.moveTo(-10,0);
	spritemid.ctx.lineTo(10,0);
	spritemid.ctx.stroke();

	$('spritecentre').style.left=500;
	$('spritecentre').style.top=200;
	DDspritecentre=new YAHOO.util.DD('spritecentre');

	
	


	$('msg').innerHTML=flname+fstar;
	$('sceneradio').checked='checked';
	$('scenehold').innerHTML='';
	
	if (window.File && window.FileReader && window.FileList && window.Blob && !iop) 
	{
		$('ifas').innerHTML='Open Files';
	}
	
/*	
	A=new Group();
	A.members=["a","b","c"];
	D=new Group();
	D.members=["d", "e", A];
	F=new Group();
	F.members=["f"];
	G=new Group();
	G.members=["g", "h"];
	H=new Group();
	H.members=[F,G];
	K=new Group();
	K.members=["k",D,H];
	alert(separate(K.members));
*/	
}

</script>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-23932681-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</head>
<body onLoad="init()">
<div id='startdiv' 	style='width:100%; height:100%; top:52px; background-color:#FFFFFF; font-size:18px'>
      <div style='top:200px;left:400px '><img src='assets/3d_cd.gif'/> Please wait while the application finishes loading.....</div>
</div>



<div id="canvasdiv"></div>
<div id="hidecanvas"></div>
<div id='animationdiv'></div>
<div id="bodydiv"></div>
<div id="filmbodydiv"></div>
<div id="filmdivhandle"></div>
<canvas id='gradcanvas'> </canvas>


<div id='background'></div>
<div id='stagearea'></div>


<div id="shapestage" class="theatre_style"></div>
<div id="scenestage" class="theatre_style"></div>
<div id="spritestage" class="theatre_style"></div>
<div id="trackstage" class="theatre_style"></div>
<div id="tweenstage" class="theatre_style"></div>
<div id="filmstage" class="theatre_style"></div>

<div id="stageframe"></div>
<!--dialogue box setting stage width and height-->
<div id='stagebox' class="dialoguebox">
	<div id='stagehead' class='head'>&nbsp; New Stage</div>
	<div id='stagecontent' class='content'>
		<p class="text_input">
			<label for="stagewidth">Width</label> <input type="text" name"stagewidth" id="stagewidth" value=1000 size=5/><span>px</span>
		</p>
		<p class="text_input">
			<label for="stageheight">Height</label> <input type="text" name"stageheight" id="stageheight" value=500 size=5/><span>px</span>
		</p>
		
		<input type="button" value=" OK " id="stageOK" onclick="setStage()" />
	</div>	
</div>
<canvas id='gridcanvas'> </canvas>
<div id="backstage" class="theatre_style"></div>
<div id="markerdrop" class="theatre_style" ></div>
<div id="boundarydrop" class="theatre_style" ></div>

<!--dialogue box for colour picker-->
<div id='colorcont' class="dialoguebox">
  <div id='colorpick' >
  	  <div id="coldigits" >
      	<div style="border: 1px solid black;height:50px;width:145px;top:0px;left:0px;">
        	<div id="quickColor"></div>
        	<div id="staticColor"></div>
      	</div>
      	<table width=145 style="position:absolute;top:55px;">
       	 <tr>
	          <td>Hex: </td>
    	      <td><input style="margin:0.3em;" size="8" type="text" id="hexBox" onChange="hexBoxChanged();" />
        	  </td>
	        </tr>
    	    <tr>
        	  <td>Red: </td>
	          <td><input style="margin:0.3em;" size="8" type="text" id="redBox" onChange="redBoxChanged();" />
	          </td>
    	    </tr>
        	<tr>
	          <td>Green: </td>
    	      <td><input style="margin:0.3em;" size="8" type="text" id="greenBox" onChange="greenBoxChanged();" />
        	  </td>
	        </tr>
	        <tr>
    	      <td>Blue: </td>
        	  <td><input style="margin:0.3em;" size="8" type="text" id="blueBox" onChange="blueBoxChanged();" />
	          </td>
    	    </tr>
        	<tr>
	          <td>Hue: </td>
	          <td><input style="margin:0.3em;" size="8" type="text" id="hueBox" onChange="hueBoxChanged();" />
    	      </td>
        	</tr>
	        <tr>
    	      <td>Saturation: </td>
        	  <td><input style="margin:0.3em;" size="8" type="text" id="saturationBox" onChange="saturationBoxChanged();" />
	          </td>
    	    </tr>
        	<tr>
	          <td>Value: </td>
    	      <td><input style="margin:0.3em;" size="8" type="text" id="valueBox" onChange="valueBoxChanged();" />
        	  </td>
	        </tr>
    	  </table>
    	  <div id="colvertline"><img id="colptr" src="assets/openpointer.png" style="position: absolute; top: 183px" onclick="colexpand()"/></div>
	    </div>
    <div id='colormask'></div>	
  
    <div id='colform' >
      <input type="button" id="OKbut" value="OK" onClick="setColor();closeColor()">
	  <input type="button" id="Applybut" value="Apply" onClick="setColor()">
      <input type="button" id="Cancel" value="Cancel" onClick="closeColor()">
    </div>
    <div id ='transpbox' >
      <div id='transptext'>Transparency 0%</div>
      <div id='transpimg'><img class='marker' id="check" src="assets/check.png" /> </div>
      <div id='transpslider'> </div>
      <div id='transpcover'> </div>
      <img class='marker' id="varrows" src="assets/transp_arrows.gif" /> </div>
    <div id="gradientBox" style=""> <img id="gradientImg" src="assets/color_picker_gradient.png" /> <img class='marker' id="circle" src="assets/color_picker_circle.gif" /> </div>
    <div id="hueBarDiv" style=""> <img class='marker' id='colorbar' src="assets/color_picker_bar.png" /> <img class='marker' id="arrows" src="assets/color_picker_arrows.gif" /> <br />
    </div>
  </div>
  <div id='colorhead' class="head">
    	<div id="colorheadtext">&nbsp; Line Colour</div>
    	<img src='assets/x.png' onclick='closedialogue(this)'/>
    	<img src='assets/up.png' onclick='updialogue(this,"colorpick")'/>
  </div>  
</div>

<div id='anibar'>
  <div id='anibarhd'> &nbsp; Animation </div>
  
   <div id='anigroup'>	

	<div id='scenegroup'>
		<div class="bar"></div>	
		<div id='aniscene' onMouseOver="this.style.opacity=1;this.filters.alpha.opacity=100"
		onmouseout="this.style.opacity=0.6;this.filters.alpha.opacity=60" onClick="animenuset('scene')">&nbsp; Scenery </div>
		<div id='scenehold'></div>
	</div>
	<div id='spritegroup'>
		<div class="bar"></div>	
		<div id='anisprite' onMouseOver="this.style.opacity=1;this.filters.alpha.opacity=100"
		onmouseout="this.style.opacity=0.6;this.filters.alpha.opacity=60" onClick="animenuset('sprite')">&nbsp; Sprites </div>
		<div id='spritehold'></div>
	</div>
	<div id='tweengroup'>
		<div class="bar"></div>		
		<div id='anitween' onMouseOver="this.style.opacity=1;this.filters.alpha.opacity=100"
		onmouseout="this.style.opacity=0.6;this.filters.alpha.opacity=60" onClick="animenuset('tween')">&nbsp; Tweens </div>
		<div id='tweenhold'></div>
	</div>
	<div id='filmgroup'>
		<div class="bar"></div>	
		<div id='anifilm' onMouseOver="this.style.opacity=1;this.filters.alpha.opacity=100"
		onmouseout="this.style.opacity=0.6;this.filters.alpha.opacity=60" onClick="animenuset('film')">&nbsp; Films </div>
		<div id='filmhold'></div>
	</div>
	<div id='trackgroup'>
		<div class="bar"></div>	
		<div id='anitrack' onMouseOver="this.style.opacity=1;this.filters.alpha.opacity=100"
		onmouseout="this.style.opacity=0.6;this.filters.alpha.opacity=60" onClick="animenuset('track')">&nbsp; Tracks </div>
		<div id='trackhold'></div>
	</div>
	
		
   </div>
   <div id='msggroup'> </div>
   <div id='msgblank'> </div>
	<div id='buildgroup'>
		<div id='anibuild' alt="build animation element" title="build animation element">&nbsp; Creator</div>	
		<div id='buildhold'>
		    <p>
			<input type="radio" id="sceneradio" name="buildradio" onChange="aniobj='scene'" checked="checked"> Scenery<br> 
			<input type="radio" name="buildradio" onChange="aniobj='sprite'"> Sprite<br>
			<input type="radio"name="buildradio" onChange="aniobj='tween'"> Tween<br>
			<input type="radio"name="buildradio" onChange="aniobj='track'"> Track<br>
			<input type="radio" name="buildradio" onChange="aniobj='film'"> Film<br><p>
			&nbsp;&nbsp;&nbsp;<input type="button" onClick="buildobj()" value="Build">
		</div> 
	</div>	
</div>

<div id='filmsbar'>
  <div id='filmsbrhead'> Film Elements </div>
  <div id='filmsholder'>
Film Elements from back to front.<br>
<ul id="anielmorder" style="list-style-type:none;padding:2px;text-align:left"></ul>
</div>
<div id='filmsmove'> <img src="assets/uparw.png" onClick="moveliup()">&nbsp; &nbsp;&nbsp;<img src="assets/downarw.png" onClick="movelidown()"></div>
 </div>

<div id='toolbar'>
  <div id='tlbrhead'> &nbsp; Tools </div>
  <div class="choice40" id='menushape'  alt="insert shapes" title="insert shapes" onclick="showmenu()" onmouseover="this.className='choice100'" onmouseout="this.className='choice40'"> <img src="assets/menushapes.png"> </div>
  <div class="choice40" id='editlines'  alt="edit lines" title="edit lines" onclick="markLine(selected[0])" onmouseover="this.className='choice100'"  onmouseout="this.className='choice40'"> <img src="assets/editlines.png"> </div>
  <div class="choice40" id='group'  alt="group shapes" title="group shapes" onclick="group()" onmouseover="this.className='choice100'"  onmouseout="this.className='choice40'"> <img src="assets/group.png"> </div>
  <div class="choice40" id='ungroup'  alt="ungroup shapes" title="ungroup shapes" onclick="ungroup()" onmouseover="this.className='choice100'"  onmouseout="this.className='choice40'"> <img src="assets/ungroup.png"> </div>
  <div class="choice40" id='stylelines'  alt="line styles" title="line styles" onclick="linestyles()" onmouseover="this.className='choice100'"  onmouseout="this.className='choice40'"> <img src="assets/stylelines.png"> </div>
  <div class="choice40" id='collines'  alt="line colour" title="line colour" onclick="linecolor()" onmouseover="this.className='choice100'" onmouseout="this.className='choice40'"> <img src="assets/collines.png"> </div>
  <div class="choice40" id='colfill'  alt="fill colour" title="fill colour" onclick="fillcolor()" onmouseover="this.className='choice100'" onmouseout="this.className='choice40'"> <img id='colimg' src="assets/colfill.png"> </div>
  <div class="choice40" id='gradfill'  alt="gradient fill" title="gradient fill" onclick="gradfill()" onmouseover="this.className='choice100'" onmouseout="this.className='choice40'"> <img id='gradimg' src="assets/gradfilloff.png"> </div>
  <div class="choice40" id='rotate'  alt="rotate" title="rotate" onclick="canvrotate()" onmouseover="this.className='choice100'" onmouseout="this.className='choice40'"> <img src="assets/rotate.png"> </div>
  <div class="choice40" id='front'  alt="bring to front" title="bring to front" onclick="bringfront()" onmouseover="this.className='choice100'"  onmouseout="this.className='choice40'"> <img src="assets/front.png"> </div>
  <div class="choice40" id='back'  alt="send to back" title="send to back" onclick="sendback()" onmouseover="this.className='choice100'" onmouseout="this.className='choice40'"> <img src="assets/back.png"> </div>
  <div class="choice40" id='grid'  alt="set grid" title="set grid" onclick="setgrid()" onmouseover="this.className='choice100'" onmouseout="this.className='choice40'"> <img src="assets/grid.png"> </div>
  <div class="choice40" id='del'  alt="delete" title="delete" onclick="shapedelete()" onmouseover="this.className='choice100'" onmouseout="this.className='choice40'"> <img src="assets/delete.png"> </div>
  <div class="choice40" id='copy'  alt="copy" title="copy" onclick="shapecopy(10)" onmouseover="this.className='choice100'" onmouseout="this.className='choice40'"> <img src="assets/copy.png"> </div>
  <div class="choice40" id='vert'  alt="flip vertical" title="flip vertical" onclick="flipvert()" onmouseover="this.className='choice100'" onmouseout="this.className='choice40'"> <img src="assets/vert.png"> </div>
  <div class="choice40" id='horz'  alt="flip horizontal" title="flip horizontal" onclick="fliphorz()" onmouseover="this.className='choice100'" onmouseout="this.className='choice40'"> <img src="assets/horz.png"> </div>
  <div class="choice40" id='alntop'  alt="align top" title="align top" onclick="aligntop()" onmouseover="this.className='choice100'" onmouseout="this.className='choice40'"> <img src="assets/alntop.png"> </div>
  <div class="choice40" id='alnbot'  alt="align bottom" title="align bottom" onclick="alignbot()" onmouseover="this.className='choice100'" onmouseout="this.className='choice40'"> <img src="assets/alnbot.png"> </div>
  <div class="choice40" id='alnleft'  alt="align left" title="align left" onclick="alignleft()" onmouseover="this.className='choice100'" onmouseout="this.className='choice40'"> <img src="assets/alnleft.png"> </div>
  <div class="choice40" id='alnright'  alt="align right" title="align right" onclick="alignright()" onmouseover="this.className='choice100'" onmouseout="this.className='choice40'"> <img src="assets/alnright.png"> </div>
  <div class="choice40" id='lundo'  alt="undo delete" title="undo delete" onclick="undolast()" onmouseover="this.className='choice100'" onmouseout="this.className='choice40'"> <img src="assets/undo.png"> </div>	
  <div class="choice40" id='shadow'  alt="shadow" title="shadow" onclick="shadow()" onmouseover="this.className='choice100'" onmouseout="this.className='choice40'"> <img src="assets/shadow.png"> </div>
  <div class="choice40" id='sname'  alt="shape name" title="shape name" onclick="shapename()" onmouseover="this.className='choice100'" onmouseout="this.className='choice40'"> <img src="assets/shapename.png"> </div>
	
</div>



<div id="heading"><div id='msg' style='top:2px; left:550px; width:300px ;height:40px; '> </div>
 <div id='logo'><img src="assets/logo.png"></div>
  
  <div class="choice40" id='export'  alt="To HTML" title="To HTML" onclick="$('fopts').style.visibility='visible'" onmouseover="this.className='choice100'" onmouseout="this.className='choice40'"> <img src="assets/export.png"> </div>
  <div class='choice40' id='visit' alt="Visit Gallery" title="Visit Gallery" onclick='visitgallery()' onmouseover="this.className='choice100'" onmouseout="this.className='choice40'"> <img src='assets/visit.png'> </div>
  <div class='choice40' id='help' alt="help" title="help" onclick='openhelp()' onmouseover="this.className='choice100'" onmouseout="this.className='choice40'"> <img src='assets/help.png'> </div>	
	
  <div id='fopts'><a href='#' onClick="writeCanvas();$('fopts').style.visibility='hidden' ;return false">Export Canvas to HTML</a><p><a href='#' onClick="writeFilm();$('fopts').style.visibility='hidden' ;return false">Export Film to HTML</a><p><a href='#' onClick="totext();$('fopts').style.visibility='hidden' ; return false;"><span id='ofas'>Export as TEXT</span></a></p><p><a href='#' onClick="fromtext(); $('fopts').style.visibility='hidden' ;return false;"><span id='ifas'>Input File as Text</span></a></p></div>			
</div>
<div id='vecdiv'>
  
  <canvas id='vecanv'></canvas>
  <div id='vecrotate' ><canvas id='vecircdiv'></canvas></div>
</div>
<div id='spritecentre'>
	<canvas id='spritemidiv'></canvas>
</div> 
 
</body>
</html>
